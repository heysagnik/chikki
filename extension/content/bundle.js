let n=null,m=null,C=null;function D(e,o,u,l,r){A(),n=document.createElement("div"),n.className="tone-popup",n.style.position="absolute",n.style.zIndex="100000",n.style.width="240px",n.style.background="hsl(240, 10%, 3.9%)",n.style.borderRadius="8px",n.style.boxShadow="0px 10px 38px -10px hsla(240, 30%, 5%, 0.35), 0px 10px 20px -15px hsla(240, 30%, 5%, 0.2)",n.style.border="1px solid hsl(240, 5%, 12%)",n.style.display="flex",n.style.flexDirection="column",n.style.padding="16px",n.style.color="hsl(0, 0%, 98%)",n.style.fontFamily="Inter, system-ui, -apple-system, sans-serif",n.style.fontSize="14px",n.style.gap="12px";const y=document.createElement("div");y.style.display="flex",y.style.justifyContent="space-between",y.style.alignItems="center",y.style.marginBottom="4px";const E=document.createElement("div");E.textContent="Adjust tone",E.style.fontWeight="500",E.style.fontSize="14px",E.style.color="hsl(0, 0%, 98%)",E.style.letterSpacing="-0.01em";const p=document.createElement("button");p.innerHTML='<svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>',p.style.background="transparent",p.style.border="none",p.style.color="hsl(240, 5%, 65%)",p.style.cursor="pointer",p.style.padding="4px",p.style.display="flex",p.style.alignItems="center",p.style.justifyContent="center",p.style.borderRadius="4px",p.style.transition="background-color 150ms, color 150ms",p.onmouseover=()=>p.style.backgroundColor="hsl(240, 5%, 12%)",p.onmouseout=()=>p.style.backgroundColor="transparent",p.onclick=A,y.appendChild(E),y.appendChild(p),n.appendChild(y);const d=document.createElement("div");d.className="tone-picker",d.style.position="relative",d.style.width="100%",d.style.aspectRatio="1 / 1",d.style.display="grid",d.style.gridTemplateRows="repeat(3, 1fr)",d.style.gridTemplateColumns="repeat(3, 1fr)",d.style.backgroundColor="hsl(240, 5%, 10%)",d.style.borderRadius="6px",d.style.cursor="pointer",d.style.overflow="hidden",d.style.userSelect="none";for(let c=0;c<9;c++){const t=document.createElement("div");t.style.border="1px solid hsl(240, 5%, 15%)",t.style.transition="background-color 150ms",t.dataset.index=c,t.addEventListener("click",g=>P(g,c)),t.addEventListener("mouseover",()=>t.style.backgroundColor="hsla(240, 5%, 15%, 0.5)"),t.addEventListener("mouseout",()=>t.style.backgroundColor="transparent"),d.appendChild(t)}[{text:"Professional",x:1,y:0,align:"center",valign:"top"},{text:"Casual",x:1,y:2,align:"center",valign:"bottom"},{text:"Concise",x:0,y:1,align:"left",valign:"middle"},{text:"Expanded",x:2,y:1,align:"right",valign:"middle"}].forEach(c=>{const t=document.createElement("span");t.textContent=c.text,t.style.position="absolute",t.style.fontSize="12px",t.style.color="hsl(240, 5%, 65%)",t.style.fontWeight="500",t.style.padding="6px",c.align==="center"?(t.style.left="50%",t.style.transform="translateX(-50%)"):c.align==="left"?t.style.left="0":t.style.right="0",c.valign==="middle"?(t.style.top="50%",t.style.transform+=" translateY(-50%)"):c.valign==="top"?t.style.top="0":t.style.bottom="0",d.appendChild(t)}),m=document.createElement("div"),m.className="tone-dot",m.style.position="absolute",m.style.width="16px",m.style.height="16px",m.style.background="hsl(9, 100%, 64%)",m.style.border="2px solid hsl(0, 0%, 100%)",m.style.borderRadius="50%",m.style.boxShadow="0 0 0 1px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.15)",m.style.transform="translate(-50%, -50%)",m.style.zIndex="10",d.appendChild(m),n.appendChild(d);const v=document.createElement("div");v.style.display="flex",v.style.flexDirection="column",v.style.gap="8px";const w=document.createElement("div");w.textContent="Quick presets",w.style.fontSize="12px",w.style.color="hsl(240, 5%, 65%)",w.style.fontWeight="500",v.appendChild(w);const T=document.createElement("div");T.style.display="grid",T.style.gridTemplateColumns="1fr 1fr",T.style.gap="8px",["Executive","Technical","Basic","Educational"].forEach(c=>{const t=document.createElement("button");t.textContent=c,t.style.padding="6px 12px",t.style.backgroundColor="hsl(240, 5%, 12%)",t.style.border="1px solid hsl(240, 5%, 20%)",t.style.borderRadius="4px",t.style.color="hsl(0, 0%, 96%)",t.style.fontSize="12px",t.style.fontWeight="500",t.style.cursor="pointer",t.style.transition="background-color 150ms, border-color 150ms",t.addEventListener("mouseover",()=>{t.style.backgroundColor="hsl(240, 5%, 16%)"}),t.addEventListener("mouseout",()=>{t.style.backgroundColor="hsl(240, 5%, 12%)"}),t.addEventListener("click",()=>W(c)),T.appendChild(t)}),v.appendChild(T),n.appendChild(v),C=document.createElement("div"),C.className="loading-skeleton",C.style.width="100%",C.style.height="38px",C.style.background="linear-gradient(90deg, hsl(240, 5%, 12%) 25%, hsl(240, 5%, 16%) 50%, hsl(240, 5%, 12%) 75%)",C.style.backgroundSize="200% 100%",C.style.borderRadius="4px",C.style.display="none",n.appendChild(C);const i=document.createElement("div");i.className="tone-result",i.style.width="100%",i.style.minHeight="38px",i.style.fontSize="14px",i.style.lineHeight="1.5",i.style.textAlign="left",i.style.display="none",i.style.wordBreak="break-word",i.style.color="hsl(0, 0%, 96%)",i.style.backgroundColor="hsl(240, 5%, 10%)",i.style.padding="8px 10px",i.style.borderRadius="4px",i.style.border="1px solid hsl(240, 5%, 20%)",i.style.maxHeight="120px",i.style.overflowY="auto",i.style.scrollbarWidth="thin",i.style.scrollbarColor="hsl(240, 5%, 30%) transparent",n.appendChild(i);const s=document.createElement("button");s.textContent="Replace selection",s.style.marginTop="4px",s.style.background="hsl(224, 82%, 56%)",s.style.color="white",s.style.border="none",s.style.borderRadius="4px",s.style.padding="8px 0",s.style.cursor="pointer",s.style.fontSize="14px",s.style.fontWeight="500",s.style.width="100%",s.style.display="none",s.style.transition="background-color 150ms",s.disabled=!0,s.onmouseover=()=>{s.disabled||(s.style.backgroundColor="hsl(224, 82%, 51%)")},s.onmouseout=()=>{s.disabled||(s.style.backgroundColor="hsl(224, 82%, 56%)")},s.onclick=()=>{l&&i.textContent&&(r(i.textContent),A())},n.appendChild(s),n.style.left=`${e-100}px`,n.style.top=`${o+12}px`,document.body.appendChild(n),k(1,1,d),setTimeout(()=>{document.addEventListener("mousedown",R)},0);function P(c,t){const g=t%3,h=Math.floor(t/3);k(g,h,d);let b;h===0&&g===0?b="professional and concise":h===0&&g===1?b="professional":h===0&&g===2?b="professional and expanded":h===1&&g===0?b="concise":h===1&&g===1?b="neutral":h===1&&g===2?b="expanded":h===2&&g===0?b="casual and concise":h===2&&g===1?b="casual":h===2&&g===2&&(b="casual and expanded"),N(b)}function W(c){let t=c.toLowerCase();switch(c){case"Executive":k(0,0,d);break;case"Technical":k(2,0,d);break;case"Basic":k(0,2,d);break;case"Educational":k(2,2,d);break}N(t)}function k(c,t,g){const h=g.clientWidth/3,b=g.clientHeight/3,H=(c+.5)*h,X=(t+.5)*b;m.style.left=`${H}px`,m.style.top=`${X}px`}function N(c){C.style.display="block",i.style.display="none",s.style.display="none",chrome.runtime.sendMessage({action:"performAiAction_changeTone",data:{text:u,tone:c}},t=>{C.style.display="none",i.style.display="block",t&&t.success&&t.data?(i.textContent=t.data,s.disabled=!1,s.style.display="block"):i.textContent=(t==null?void 0:t.error)||"Failed to generate text."})}}function A(){n&&(n.remove(),n=null,document.removeEventListener("mousedown",R))}function R(e){n&&!n.contains(e.target)&&A()}console.log("AI Writing Assistant Content Script Loaded.");let x=null,a=null,f=null,L=null,I="";function S(e){return e&&(e.tagName==="TEXTAREA"||e.isContentEditable||e.tagName==="INPUT"&&/^(text|search|email|url)$/i.test(e.type))}function F(e){return e.isContentEditable?window.getSelection().toString():e.value!==void 0?e.value.substring(e.selectionStart,e.selectionEnd):""}function z(e,o,u=!1){if(e){if(e.isContentEditable){const l=window.getSelection();if(l.rangeCount>0){const r=l.getRangeAt(0);u&&r.deleteContents(),r.insertNode(document.createTextNode(o)),r.collapse(!1),l.removeAllRanges(),l.addRange(r)}else e.focus(),document.execCommand("insertText",!1,o)}else if(e.value!==void 0){const l=e.selectionStart,r=e.selectionEnd,y=e.value;u?(e.value=y.substring(0,l)+o+y.substring(r),e.selectionStart=e.selectionEnd=l+o.length):(e.value=y.substring(0,l)+o+y.substring(l),e.selectionStart=e.selectionEnd=l+o.length),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}e.focus()}}function Y(e){if(!e)return;a||(a=document.createElement("button"),a.innerText="✨ AI",a.className="ai-assistant-button",a.style.position="absolute",a.style.zIndex="9999",a.addEventListener("click",G),document.body.appendChild(a));const o=e.getBoundingClientRect();a.style.top=`${window.scrollY+o.bottom-28}px`,a.style.left=`${window.scrollX+o.right-40}px`,a.style.display="block",a.dataset.targetElementId=e.id||Math.random().toString(36).substring(7),e.id||(e.id=a.dataset.targetElementId)}function j(){a&&(a.style.display="none")}function G(e){if(e.stopPropagation(),!x)return;const o=F(x),u=x.isContentEditable?x.textContent:x.value,l=o?"fixGrammar":"autocomplete",r=o||u;r&&($(x),chrome.runtime.sendMessage({action:`performAiAction_${l}`,data:{text:r}},y=>{if(M(),!chrome.runtime.lastError&&y&&y.success&&y.data){const E=l==="fixGrammar"&&!!o||l==="rewrite";z(x,y.data,E)}}))}document.addEventListener("focusin",e=>{S(e.target)&&(x=e.target,setTimeout(()=>{document.activeElement===x&&Y(x)},150))});document.addEventListener("focusout",e=>{S(e.target)&&setTimeout(()=>{document.activeElement!==a&&document.activeElement!==e.target&&(j(),x===e.target&&(x=null))},200)});chrome.runtime.onMessage.addListener((e,o,u)=>{if(e.action==="triggerAiFromContextMenu"){const l=x||document.activeElement;if(S(l)&&e.data&&e.data.text&&e.data.actionType)return $(l),chrome.runtime.sendMessage({action:`performAiAction_${e.data.actionType}`,data:{text:e.data.text}},r=>{if(M(),chrome.runtime.lastError){u({success:!1,error:chrome.runtime.lastError.message});return}r&&r.success&&r.data?(z(l," "+r.data),u({success:!0})):u({success:!1,error:r==null?void 0:r.error})}),!0;u({success:!1,error:"No active editable element"})}});function $(e){a&&a.dataset.targetElementId===e.id&&(a.innerText="⏳",a.disabled=!0)}function M(){a&&(a.innerText="✨ AI",a.disabled=!1)}function _(e,o){f||(f=document.createElement("button"),f.className="magic-band-btn",f.innerText="🪄",f.style.position="absolute",f.style.zIndex="99999",f.addEventListener("click",()=>{D(parseInt(f.style.left,10),parseInt(f.style.top,10),I,L,u=>{L&&(L.deleteContents(),L.insertNode(document.createTextNode(u)))})}),document.body.appendChild(f)),f.style.left=`${e}px`,f.style.top=`${o}px`,f.style.display="block"}function B(){f&&(f.style.display="none"),A()}document.addEventListener("mouseup",e=>{const o=window.getSelection();if(o&&o.rangeCount>0&&!o.isCollapsed){const u=o.getRangeAt(0),l=u.startContainer.parentElement;if(S(l)&&(!l.tagName||l.tagName==="TEXTAREA"||l.isContentEditable||l.tagName==="INPUT"&&/^(text|search|email|url)$/i.test(l.type))){L=u,I=o.toString();const r=u.getBoundingClientRect();_(window.scrollX+r.right,window.scrollY+r.top-32)}else B()}else B()});
